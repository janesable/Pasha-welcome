class QuizManager {
    constructor() {
        this.questions = [
            {
                question: "Что вызывает малярию?",
                answers: ["Паразиты Plasmodium", "Бактерии", "Вирусы", "Грибки"],
                correct: 0,
                explanation: "Малярия вызывается паразитами рода Plasmodium, которые передаются через укусы комаров. Эти микроскопические паразиты размножаются в печени человека и затем заражают красные кровяные клетки."
            },
            {
                question: "Какие органы человека поражает малярийный паразит в первую очередь?",
                answers: ["Печень и эритроциты", "Легкие и бронхи", "Желудок и кишечник", "Мозг и нервная система"],
                correct: 0,
                explanation: "Малярийный паразит сначала попадает в печень, где размножается, а затем поражает эритроциты (красные кровяные клетки), вызывая их разрушение и характерные приступы лихорадки."
            },
            {
                question: "Каков основной симптом малярии?",
                answers: ["Периодические приступы лихорадки", "Постоянная головная боль", "Кожная сыпь", "Потеря слуха"],
                correct: 0,
                explanation: "Основным симптомом малярии являются периодические приступы лихорадки с характерной цикличностью, сопровождающиеся ознобом и потом."
            },
            {
                question: "Как долго малярийный паразит может находиться в печени человека?",
                answers: ["До нескольких лет", "Несколько дней", "Один месяц", "Несколько часов"],
                correct: 0,
                explanation: "Некоторые формы малярийного паразита могут оставаться в печени человека в течение нескольких лет, вызывая рецидивы заболевания."
            },
            {
                question: "Какое время суток комары Anopheles наиболее активны?",
                answers: ["В сумерках и ночью", "Утром", "В полдень", "После полудня"],
                correct: 0,
                explanation: "Комары Anopheles наиболее активны в сумеречное и ночное время, что делает использование противомоскитных сеток во время сна особенно важным."
            },
            {
                question: "Какой метод профилактики малярии наиболее эффективен?",
                answers: ["Комплексный подход", "Только противомоскитные сетки", "Только репелленты", "Только таблетки"],
                correct: 0,
                explanation: "Наиболее эффективен комплексный подход, включающий использование противомоскитных сеток, репеллентов, профилактических препаратов и контроль размножения комаров."
            },
            {
                question: "Кто открыл возбудителя малярии?",
                answers: ["Шарль Луи Альфонс Лаверан", "Луи Пастер", "Роберт Кох", "Александр Флеминг"],
                correct: 0,
                explanation: "Французский военный врач Шарль Луи Альфонс Лаверан открыл малярийного паразита в 1880 году, за что позже получил Нобелевскую премию."
            },
            {
                question: "Какой препарат исторически использовался для лечения малярии?",
                answers: ["Хинин", "Аспирин", "Пенициллин", "Инсулин"],
                correct: 0,
                explanation: "Хинин, получаемый из коры хинного дерева, был первым эффективным средством лечения малярии и использовался на протяжении столетий."
            },
            {
                question: "Как климатические изменения влияют на распространение малярии?",
                answers: ["Расширяют ареал комаров", "Уменьшают ареал комаров", "Не влияют", "Влияют только на скорость полета комаров"],
                correct: 0,
                explanation: "Глобальное потепление расширяет географический ареал малярийных комаров, создавая благоприятные условия для их размножения в новых регионах."
            },
            {
                question: "Какой пол комаров Anopheles переносит малярию?",
                answers: ["Только самцы", "Только самки", "Оба пола", "Ни один из полов"],
                correct: 1,
                explanation: "Только самки комаров Anopheles переносят малярию, так как только они питаются кровью для развития яиц."
            },
            {
                question: "Через какое время после укуса зараженного комара появляются первые симптомы?",
                answers: ["7-30 дней", "1-2 дня", "Сразу", "Через полгода"],
                correct: 0,
                explanation: "Инкубационный период малярии обычно составляет от 7 до 30 дней, в зависимости от вида паразита."
            },
            {
                question: "Какое основное отличие комаров Anopheles от других видов?",
                answers: ["Поза при посадке", "Цвет", "Размер", "Скорость полета"],
                correct: 0,
                explanation: "Комары Anopheles отличаются характерной позой при посадке - их брюшко направлено под углом к поверхности, в то время как у других видов оно параллельно поверхности."
            },
            {
                question: "Какой метод используется для массовой борьбы с комарами?",
                answers: ["Осушение водоемов", "Посадка деревьев", "Увеличение популяции птиц", "Повышение температуры воздуха"],
                correct: 0,
                explanation: "Осушение стоячих водоемов - одна из наиболее эффективных мер борьбы с комарами, так как они являются местами размножения комаров."
            },
            {
                question: "Какая температура наиболее благоприятна для развития малярийных паразитов в комаре?",
                answers: ["20-30°C", "5-15°C", "35-40°C", "Ниже 5°C"],
                correct: 0,
                explanation: "Оптимальная температура для развития малярийных паразитов в организме комара составляет 20-30°C."
            },
            {
                question: "Какой процент случаев малярии в мире вызывается Plasmodium falciparum?",
                answers: ["Более 75%", "Менее 25%", "Около 50%", "Около 10%"],
                correct: 0,
                explanation: "Более 75% всех случаев малярии вызывается P. falciparum, самым опасным видом малярийного паразита."
            },
            {
                question: "Какое осложнение малярии наиболее опасно?",
                answers: ["Церебральная малярия", "Анемия", "Желтуха", "Пневмония"],
                correct: 0,
                explanation: "Церебральная малярия - наиболее опасное осложнение, при котором поражается головной мозг, что может привести к коме и смерти."
            },
            {
                question: "Какой фактор не влияет на распространение малярии?",
                answers: ["Высота над уровнем моря", "Цвет почвы", "Влажность воздуха", "Температура"],
                correct: 1,
                explanation: "Цвет почвы не влияет на распространение малярии, в то время как высота, влажность и температура являются ключевыми факторами."
            },
            {
                question: "Как долго может жить взрослый комар Anopheles?",
                answers: ["3-6 недель", "1-2 дня", "6 месяцев", "Несколько лет"],
                correct: 0,
                explanation: "При благоприятных условиях взрослый комар Anopheles может жить 3-6 недель, хотя некоторые особи могут жить дольше."
            },
            {
                question: "Какое количество яиц может отложить самка комара Anopheles за один раз?",
                answers: ["50-200 яиц", "5-10 яиц", "500-1000 яиц", "1-5 яиц"],
                correct: 0,
                explanation: "Самка комара Anopheles может отложить от 50 до 200 яиц за одну кладку, что обеспечивает быстрый рост популяции при благоприятных условиях."
            }
        ];
    }

    startQuiz() {
        this.currentQuestion = Math.floor(Math.random() * this.questions.length);
        this.showQuestion();
    }

    showQuestion() {
        const question = this.questions[this.currentQuestion];
        const container = document.getElementById('quiz-container');
        const questionEl = document.getElementById('question');
        const answersEl = document.getElementById('answers');

        container.classList.remove('hidden');
        questionEl.textContent = question.question;
        answersEl.innerHTML = '';

        question.answers.forEach((answer, index) => {
            const button = document.createElement('button');
            button.textContent = answer;
            button.addEventListener('click', () => this.checkAnswer(index));
            answersEl.appendChild(button);
        });
    }

    checkAnswer(answerIndex) {
        const question = this.questions[this.currentQuestion];
        const isCorrect = answerIndex === question.correct;
        
        if (isCorrect && game.level === 1) {
            game.level = 2;
            this.showExplanation(true, question.explanation, true);
        } else {
            this.showExplanation(isCorrect, question.explanation, false);
        }
    }

    showExplanation(isCorrect, explanation, startLevel2 = false) {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.innerHTML = `
            <div class="modal-content">
                <h2>${isCorrect ? 'Правильно!' : 'Неправильно'}</h2>
                <p>${explanation}</p>
                <button id="close-explanation">Продолжить</button>
            </div>
        `;
        document.body.appendChild(modal);

        document.getElementById('close-explanation').addEventListener('click', () => {
            modal.remove();
            document.getElementById('quiz-container').classList.add('hidden');
            if (startLevel2) {
                game.startGame();
            } else {
                document.getElementById('game-over').classList.remove('hidden');
            }
        });
    }
}

const quizManager = new QuizManager();